<!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="ja">

<head>

<title>pvclust: An R package for hierarchical clustering with p-values</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rev="made" href="mailto:suzuki@ef-prime.com">

</head>

<body bgcolor="white">

<p>
<table border=1 rules="none" align="right" bordercolor="gray" cellpadding=4 cellspacing=0>
<tr>
	<th>Quick Links: </th>
	<td><a href="#whats">What is pvclust?</a></td>
	<td><a href="#installation">Installation</a></td>
	<td><a href="#download">Download</a></td>
	<td><a href="#usage">Basic usage and examples</a></td>
	<td><a href="#instruction">Online Instruction</a></td>
	<td><a href="#links">Links</a>
</tr>
</table>
</p><br>

<h1><font color="red">pvclust</font></h1>
<font size="+1">An <font color="blue">R</font> package for hierarchical clustering with <i>p</i>-values</font><br><br>
<font size="+1">Ryota Suzuki</font><font size="-1">(a)</font>
and
<font size="+1">Hidetoshi Shimodaira</font><font size="-1">(b)</font><br>
<br>
<font size="-1">a)</font>
Ef-prime, Inc.<br>
<br>
<font size="-1">b)</font>
Division of Mathematical Science, Graduate School of Engineering Science, Osaka University<br>

<div align=right>
Last update: Dec 22th, 2014<br> <!-- Since Feb 24th, 2005 -->
<a href="mailto:suzuki@ef-prime.com">Ryota Suzuki</a><br>
<p>

<!-- ClustrMaps -->
<div id="clustrmaps-widget"></div><script type="text/javascript">var _clustrmaps = {'url' :
'http://www.sigmath.es.osaka-u.ac.jp/shimo-lab/', 'user' : 1150043, 'server' : '3', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' :
'2014-10-23', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www3.clustrmaps.com/counter/map.js';
var x = document.getElementsByTagName('script')[0];
x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www3.clustrmaps.com/user/261118c5b"><img
src="http://www3.clustrmaps.com/stats/maps-no_clusters/www.sigmath.es.osaka-u.ac.jp-shimo-lab--thumb.jpg"
alt="Locations of visitors to this page" /></a></noscript>
<!-- ClustrMaps -->

</p>
		</div>

<hr>

<a name="#whats"><h2>What is <font color="red">pvclust</font>?</h2></a>

<img src="fig/boston.png" alt="An example of analysis using pvclust on Boston data" width=387 height=400 align="right" hspace=10 vspace=10>

<p>
<font color="red"><b>pvclust</b></font> is an <font color="blue"><b><a href="http://www.r-project.org/">R</a></b></font> package for assessing the uncertainty in hierarchical cluster analysis. For each cluster in hierarchical clustering, quantities called <i>p</i>-values are calculated via multiscale bootstrap resampling. <i>P</i>-value of a cluster is a value between 0 and 1, which indicates how strong the cluster is supported by data.
</p>

<p>
<font color="red"><b>pvclust</b></font> provides two types of <i>p</i>-values: <font color="red"><b>AU</b></font> (<font color="red"><b>A</b></font>pproximately <font color="red"><b>U</b></font>nbiased) <i>p</i>-value and <font color="green"><b>BP</b></font> (<font color="green"><b>B</b></font>ootstrap <font color="green"><b>P</b></font>robability) value. <font color="red"><b>AU</b></font> <i>p</i>-value, which is computed by multiscale bootstrap resampling, is a better approximation to unbiased <i>p</i>-value than <font color="green"><b>BP</b></font> value computed by normal bootstrap resampling.
</p>

<p>
<font color="red"><b>pvclust</b></font> performs hierarchical cluster analysis via function <tt>hclust</tt> and automatically computes <i>p</i>-values for all clusters contained in the clustering of original data. It also provides graphical tools such as <tt>plot</tt> function or useful <tt>pvrect</tt> function which highlights clusters with relatively high/low <i>p</i>-values. Furthermore, parallel computation is available via <tt>snow</tt> package.
</p>

<p>
An example of analysis on Boston data (in library <tt>MASS</tt>) is shown in the right figure. 14 attributes of houses are examined and hierarchical clustering has been done. Values on the edges of the clustering are <i>p</i>-values (%). <font color="red">Red</font> values are <font color="red"><b>AU</b></font> <i>p</i>-values, and <font color="green">green</font> values are <font color="green"><b>BP</b></font> values. Clusters with <font color="red"><b>AU</b></font> larger than 95% are highlighted by rectangles, which are strongly supported by data.
</p>

<hr>

<a name="installation"><h2>Installation</h2></a>

<p>
<font color="red"><b>pvclust</b></font> can be easily installed from <a href="http://cran.r-project.org/">CRAN</a>. Run R on your machine (with internet access) and simply type as follows:<br>
<br>
<font color="darkblue"><tt>install.packages("pvclust")</tt></font><br>
<br>
On Windows you can use <font color="darkblue"><tt>Packages -> Install package(s) from CRAN...</tt></font> from menu bar. On Mac OS X, you can use <font color="darkblue"><tt>Packages & Data -> Toggle Package Installer</tt></font>. Source package is also available from the following links.
</p>

<hr>

<a name="download"><h2>Download</font></h2>
<p>The latest version should be found at the CRAN web site</p>
</a>
<ul>
  <li><a href="http://cran.r-project.org/web/packages/pvclust/index.html">The official pvclust page at CRAN</a></li>
</ul>


<font color="red"><b>pvclust</b></font> and its supporting document are also available from this web site:
<ul>
		<li><a href="download/pvclust_1.3-2.tar.gz">Source package (curent version: 1.3-2)</a> (tar.gz)</li>
  <li><a href="download/pvclust.pdf">Reference manual</a> (pdf)</li>
</ul>

<p>[FAQ]<br>
  Q. Is it possible to use a distance  function which is not defined in &quot;method.dist&quot; argument?<br>
A. Try the unofficial version below (only source files are available). Please be careful because  this is not well tested. This feature will be included in the next release.</p>
<p>pvclust unofficial version 090824: <a href="download/pvclust_unofficial_090824.zip">zip</a></p>
<hr>

<a name="usage"><h2>Basic usage and examples</h2></a>

<p>
<tt>example(pvclust)</tt> will give you the idea of what the package can do, as well as how to use it. This example requires <tt>MASS</tt> package and may take about a few minutes. The source code of this example can be seen in <tt>help(pvclust)</tt>.
</p>

<p>
An example of DNA microarray data analysis is also available by <tt>example(lung)</tt>. Please be aware that this example may take ten or more minutes. If parallel computing is available on your machines, we recommend the use of <tt>parPvclust</tt> function with <tt>snow</tt> package. See <tt>sample</tt> section of <tt>help(lung)</tt> and <tt>help(parPvclust)</tt>. The result of this example is shown below.<br>

<img src="fig/lung.png" width=1200 height=600 alt="example of DNA microarray data analysis of lung tumors">
</P>

<hr>

<a name="instruction"><h2>Online Instruction</h2></a>

<p>
This section gives a quick instruction about the usage of package pvclust.
First load the package as follows:
</p>

<font color="darkblue"><tt>> library(pvclust)<br></tt></font>

<p>
Then load a data file into R object. In general, data files can be loaded
using functions such as <tt>read.table</tt> or <tt>read.csv</tt>.
Here we use a sample data set <tt>lung</tt> by function <tt>data</tt> as:
</p>

<font color="darkblue"><tt>> data(lung)<br></tt></font>

<p>
The data are contained in a <tt>data.frame</tt> object which has a matrix-like structure. For example, the first three entries (rows) of the first three variables (columns) can be accessed as:
</p>

<font color="darkblue"><tt>> lung[1:3,1:5]</tt></font>
<br>
<tt>
<table border=1 cellspacing=0 cellpadding=1 bordercolor="lightslateblue">
<tr align="right">
  <td></td>
  <td>fetal_lung</td>
  <td>232-97_SCC</td>
  <td>232-97_node</td>
  <td>68-96_Adeno</td>
  <td>11-00_Adeno</td>
</tr>
<tr align="right">
  <td align="left">IMAGE:196992</td>
  <td>-0.40</td>
  <td>4.28</td>
  <td>3.68</td>
  <td>-1.35</td>
  <td>-1.74</td>
</tr>
<tr align="right">
  <td align="left">IMAGE:587847</td>
  <td>-2.22</td>
  <td>5.21</td>
  <td>4.75</td>
  <td>-0.91</td>
  <td>-0.33</td>
</tr>
<tr align="right">
  <td align="left">IMAGE:1049185</td>
  <td>-1.35</td>
  <td>-0.84</td>
  <td>-2.88</td>
  <td>3.35</td>
  <td>3.02</td>
</tr>
</table>
</tt>

<p>
In the <tt>lung</tt> data object, rows correspond to genes and columns to individuals. We conduct cluster analysis of individuals to classify individuals according to their expression patterns of genes. The main feature of pvclust is <i>p</i>-value calculation of clusters via multiscale bootstrap analysis.</p>

<p>
Then we conduct hierarchical cluster analysis with multiscale bootstrap with number of bootstrap 1000, using average method and correlation-based dissimilarity matrix as follows:
</p>

<font color="darkblue">
<tt>
> result <- pvclust(lung, method.dist="cor", method.hclust="average", nboot=1000)<br>
Bootstrap (r = 0.5)... Done.<br>
Bootstrap (r = 0.6)... Done.<br>
Bootstrap (r = 0.7)... Done.<br>
Bootstrap (r = 0.8)... Done.<br>
Bootstrap (r = 0.9)... Done.<br>
Bootstrap (r = 1.0)... Done.<br>
Bootstrap (r = 1.1)... Done.<br>
Bootstrap (r = 1.2)... Done.<br>
Bootstrap (r = 1.3)... Done.<br>
Bootstrap (r = 1.4)... Done.<br>
</tt></font>
<p>
It took us about 24 minutes on our Intel Celeron (R) 2.53GHz Windows PC with 512MB RAM. Function <tt>plot</tt> displays the result of cluster analysis, and <tt>pvrect</tt> highlights clusters with high AU <i>p</i>-values, for example, higher than 0.95 as:
</p>

<font color="darkblue"><tt>> plot(result)<br></tt></font>
<font color="darkblue"><tt>> pvrect(result, alpha=0.95)</tt></font>

<img src="fig/inst01.png" width=1200 height=600>

<p>
For a cluster with AU <i>p</i>-value > 0.95, the hypothesis that "the cluster does not exist" is rejected with significance level 0.05; roughly speaking, we can think that these highlighted clusters does not only "seem to exist" caused by sampling error, but may stably be observed if we increase the number of observation.
</p>

<p>
However, the AU <i>p</i>-values themselves include sampling error, since they are also computed by a limited number of bootstrap samples. The standard errors of AU <i>p</i>-values can graphically be checked by function <tt>seplot</tt> (a new feature of version 1.1-0) as:
</p>

<font color="darkblue"><tt>> seplot(result)</tt></font><br>
<img src="fig/inst02.png" width=480 height=480><br>

<p>
The plot shows there are some clusters whose standard values are extremely high (larger than 0.6 with AU <i>p</i>-values around 0.8). To examine these clusters more closely, interactive identification is also available by <tt>seplot</tt> with <tt>identify=TRUE</tt> option. Left-click the points of interest followed by typing as:
</p>

<font color="darkblue">
<tt>
> seplot(result, identify=TRUE)<br>
[1] 21 31<br>
</tt>
</font>

<img src="fig/inst03.png" width=480 height=480>
<br>

<p>
Right-click -> "Stop" to exit from the interactive mode (for Windows). The edge numbers of those clicked are printed in the plot, and also printed in the console. In this example, they are the 21st and 31st clusters. Then check the estimated values of these clusters with <tt>print</tt> function as:
</p>

<font color="darkblue">
<tt>
> print(result, which=c(21, 31))<br>
<br>
Cluster&nbsp;method:&nbsp;average<br>
Distance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;correlation<br>
<br>
Estimates&nbsp;on&nbsp;edges:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au&nbsp;&nbsp;&nbsp;&nbsp;bp&nbsp;se.au&nbsp;se.bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;pchi<br>
21&nbsp;0.795&nbsp;0.999&nbsp;0.733&nbsp;0.002&nbsp;-2.006&nbsp;-1.184&nbsp;0.976<br>
31&nbsp;0.793&nbsp;0.999&nbsp;0.737&nbsp;0.002&nbsp;-2.002&nbsp;-1.184&nbsp;&nbsp;&nbsp;&nbsp;NA<br>
</tt>
</font>

<p>
Take the 21st cluster for example. AU <i>p</i>-value is estimated as 0.795, with SE (standard error) 0.733. By an analogue of standard normal theory, the "true" AU <i>p</i>-value is roughly estimated to exist in between (AU - 2 * SE) and (AU + 2 * SE). From this rough inference, the true AU <i>p</i>-value seems to be in between -0.671 and 2.261. However AU is defined to be between 0 and 1, so this inference is of no meaning (Note: As shown in this example, the normal approximation fails for such large SE values. There is a better approximation for constructing confidence intervals based on z-values, though not yet implemented in our package. This feature will be included in a future release).
</p>

<p>
As this example shows, computation of AU <i>p</i>-value via multiscale bootstrap resampling requires comparatively large number of bootstrap sample size, which can be specified by <tt>nboot</tt> option. We recommend to use <tt>nboot = 1000</tt> for testing at first, and then use <tt>nboot = 10000</tt> for smaller error.
</p>

<p>
To obtain a clearer result, we conduct the same analysis with <tt>nboot = 10000</tt>:
</p>

<font color="darkblue">
<tt>
> result10k <- pvclust(lung, method.dist="cor", method.hclust="average", nboot=10000)<br>
Bootstrap (r = 0.5)... Done.<br>
Bootstrap (r = 0.6)... Done.<br>
Bootstrap (r = 0.7)... Done.<br>
Bootstrap (r = 0.8)... Done.<br>
Bootstrap (r = 0.9)... Done.<br>
Bootstrap (r = 1.0)... Done.<br>
Bootstrap (r = 1.1)... Done.<br>
Bootstrap (r = 1.2)... Done.<br>
Bootstrap (r = 1.3)... Done.<br>
Bootstrap (r = 1.4)... Done.<br>
<br>
</tt></font>

<p>
It took us about four hours on our Intel Celeron (R) 2.53GHz Windows PC with 512MB RAM. This high time consumption is the primal reason why we recommend to test the program with <tt>nboot = 1000</tt> at first. If a PC cluster system is available in your environment, computational time can considerably be reduced by using <tt>parPvclust</tt>, the parallel version of pvclust with the help of <a href="http://www.stat.uiowa.edu/~luke/R/cluster/cluster.html"><tt>snow</tt></a> package.

</p>
Now let us see how the result changed</tt>:
<p>

</p>

<font color="darkblue">
<tt>
> print(result10k, which=c(21, 31))<br>
<br>
Cluster&nbsp;method:&nbsp;average<br>
Distance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;correlation<br>
<br>
Estimates&nbsp;on&nbsp;edges:<br>
<br>
&nbsp;&nbsp;&nbsp;au&nbsp;bp&nbsp;se.au&nbsp;se.bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;pchi<br>
21&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;-4.042&nbsp;-0.104&nbsp;0.771<br>
31&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;-4.102&nbsp;-0.172&nbsp;0.635<br>
</tt>
</font>

<p>
AU <i>p</i>-values changed to 1 with standard errors 0. In need of more precise expression, the precision of values can be changed with <tt>digits</tt> option as:
</p>

<font color="darkblue">
<tt>
> print(result10k, which=c(21, 31), digits=5)<br>
<br>
Cluster&nbsp;method:&nbsp;average<br>
Distance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;correlation<br>
<br>
Estimates&nbsp;on&nbsp;edges:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bp&nbsp;&nbsp;&nbsp;se.au&nbsp;se.bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;pchi<br>
21&nbsp;0.99996&nbsp;0.99998&nbsp;0.00019&nbsp;2e-05&nbsp;-4.04168&nbsp;-0.10436&nbsp;0.77115<br>
31&nbsp;0.99996&nbsp;0.99999&nbsp;0.00025&nbsp;2e-05&nbsp;-4.10208&nbsp;-0.17232&nbsp;0.63527<br>
<br>
</tt>
</font>

<p>
This result suggests that the existence of these two clusters are strongly supported by data, with more than 99.9% confidence. We should also examine the standard errors of other clusters as well:
</p>

<font color="darkblue">
<tt>
> seplot(result10k)<br>
</tt>
</font>

<img src="fig/inst04.png" width=480 height=480>
<br>

<p>
As the plot shows almost all the clusters have standard errors smaller than 0.01. For those with somewhat higher values, we examine them with <tt>identify</tt> option and <tt>print</tt> function again: 
</p>

<font color="darkblue">
<tt>
> x <- seplot(result10k, identify=TRUE)<br>
</tt>
</font>

<img src="fig/inst05.png" width=480 height=480>
<br>

<font color="darkblue">
<tt>
> x<br>
[1]  2 65 67<br>
> print(result10k, which=x)<br>
<br>
Cluster&nbsp;method:&nbsp;average<br>
Distance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;correlation<br>
<br>
Estimates&nbsp;on&nbsp;edges:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au&nbsp;&nbsp;&nbsp;&nbsp;bp&nbsp;se.au&nbsp;se.bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;pchi<br>
2&nbsp;&nbsp;0.992&nbsp;1.000&nbsp;0.020&nbsp;0.000&nbsp;-3.157&nbsp;-0.725&nbsp;0.692<br>
65&nbsp;0.693&nbsp;0.033&nbsp;0.018&nbsp;0.001&nbsp;&nbsp;0.667&nbsp;&nbsp;1.172&nbsp;0.043<br>
67&nbsp;0.702&nbsp;0.038&nbsp;0.017&nbsp;0.001&nbsp;&nbsp;0.621&nbsp;&nbsp;1.152&nbsp;0.325<br>
</tt>
</font>

<p>
Now take our attention on the 2nd cluster. By applying 2 * SE rule again, the "true" AU <i>p</i>-value may exist between 0.952 and 1.0. Most commonly we adopt 95% significance level, so it seems to be enough stable to conclude that the existance of this cluster.
</p>

<p>
If you are more conservative and need 99% significance level, it is required to decrease the standard error down to 0.002, 10 times less than that of <tt>nboot = 10000</tt>. Generally to decrease the standard error of AU <i>p</i>-value down to A times less than current estimate, the number of bootstrap (<tt>nboot</tt>) should be increased by A^2 times. In this example, you may need 10,000 * 10^2 = 1,000,000 as the number of bootstrapping. In this example it seems to be reasonable to compromise with conclusion at 95% significance level.
</p>

<p>
If you are familiar with (or interested in) the algorithm of multiscale bootstrap resampling, its curve fitting process can be also accessed for diagnostic by function <tt>msplot</tt> as:
</p>

<font color="darkblue">
<tt>
> msplot(result10k, edges=x)<br>
</tt>
</font>

<img src="fig/inst06.png" width=300 height=900, aligh="right" hspace=10 vspace=10>

<br>

<p>
Finally display the result with <tt>nboot = 10000</tt>. Although an overall results did not change from <tt>nboot = 10000</tt>, we are more confident of the estimation accuracy of AU <i>p</i>-values as well as the existance of highlighted clusters.
</p>


<font color="darkblue">
<tt>
> plot(result10k)<br>
> pvrect(result10k, alpha=0.95)<br>
</tt>
</font>

<img src="fig/inst07.png" width=1200 height=600>
<br>

<hr>

<a name="links"><h2>Links</h2></a>


<ul>
	<li>
	<a href="http://www.cran.r-project.org/">CRAN: The Comprehensive R Archive Network</a>
	</li>
	<li>
	<a href="http://www.r-project.org/">The R Project for Statistical Computing</a>
	</li>
	<li>
	<a href="http://www.sigmath.es.osaka-u.ac.jp/shimo-lab/">Shimodaira Group</a>
	</li>
</ul>

<hr>
		For any questions or comments, please email to suzuki (at) ef-prime.com
</body>

</html>

<!-- Localized -->